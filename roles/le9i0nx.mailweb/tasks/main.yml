---

- name: Create directories
  file:
    path:   '{{ item.path }}'
    state:  '{{ item.state  | default("directory") }}'
    owner:  '{{ item.owner  | default("root") }}'
    group:  '{{ item.group  | default("root") }}'
    mode:   '{{ item.mode   | default("0755") }}'
  with_items:
    - { path: '/srv/www/sites/autoconfig/public/mail' }
    - { path: '/srv/www/sites/mail/public' }
#    - { path: '/srv/www/sites/mail/public/userlogos_data' }
#    - { path: '/srv/www/sites/mail/public/userlogos_data/avatars', owner: 'www-data', group: 'www-data' }
#    - { path: '/srv/www/sites/mail/public/protected/userlogos' }
  when: (item.path is defined and item.path)

- name: Create symlinks
  file:
    src:    '{{ item.src }}'
    dest:   '{{ item.dest }}'
    state:  '{{ item.state  | default("link") }}'
    owner:  '{{ item.owner  | default("root") }}'
    group:  '{{ item.group  | default("root") }}'
#    mode:   '{{ item.mode   | default("0755") }}'
    force:  '{{ item.force  | default("no")}}'
  with_items:
    #    - { src: '/etc/php5/mods-available/mcrypt.ini' , dest: '/etc/php5/fpm/conf.d/90-mcrypt.ini' }
    - { src: '../../mods-available/mcrypt.ini' , dest: '/etc/php5/fpm/conf.d/90-mcrypt.ini' }
    #    - { src: '/var/lib/roundcube', dest: '/srv/www/sites/{{ansible_fqdn}}/public/roundcube' }
    - { src: '/usr/share/postfixadmin', dest: '/srv/www/sites/mail/public/postfixadmin' }
    - { src: '/srv/www/roundcube', dest: '/srv/www/sites/mail/public/roundcube', force: "yes" }
  notify: [ 'Reload php5-fpm' ]

- name: copy files
  copy:
    src:    '{{ item.src }}'
    dest:   '{{ item.dest }}'
    owner:  '{{ item.owner | default("root") }}'
    group:  '{{ item.group | default("root") }}'
    mode:   '{{ item.mode | default("0755") }}'
    backup: 'yes'
  with_items:
    - { src: 'srv/www/sites/autoconfig/public/mail/config-v1.1.xml', dest: '/srv/www/sites/autoconfig/public/mail/' , mode: '0444', backup: 'no' }
#   - { src: 'srv/www/sites/mail/public/protected/userlogos/', dest: '/srv/www/sites/mail/public/protected/userlogos/' , mode: '0444', backup: 'no' }
#    - { src: 'srv/www/sites/mail/public/userlogos_data/avatars/null.jpg', dest: '/srv/www/sites/mail/public/userlogos_data/avatars/null.jpg' , mode: '0444', backup: 'no' }
    - { src: 'srv/www/sites/mail/public/logo/', dest: '/srv/www/sites/mail/public/logo/' , mode: '0444', backup: 'no' }

## vim: foldmethod=marker:tabstop=2:shiftwidth=2:softtabstop=2
